{"ast":null,"code":"import'../styles/PaymentPage.css';import React,{useState}from'react';import{useNavigate}from'react-router-dom';import{useBasket}from'../context/BasketContext';import{SHOP_ROUTE}from'../utils/consts';import axios from'axios';import'../styles/PaymentPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PaymentPage=()=>{const{basket,clearBasket}=useBasket();const[paymentStatus,setPaymentStatus]=useState(null);const[paymentMessage,setPaymentMessage]=useState(\"\");const[address,setAddress]=useState(\"\");const navigate=useNavigate();const totalPrice=basket.reduce((sum,item)=>sum+item.price,0);const handlePayment=async()=>{if(!address){setPaymentMessage('Пожалуйста, введите ваш адрес.');setPaymentStatus('error');return;}const isPaymentSuccessful=true;if(isPaymentSuccessful){setPaymentMessage('Заказ прошел успешно!');setPaymentStatus('success');clearBasket();try{if(basket.length===0){throw new Error('Корзина пуста');}const devices=basket.map(item=>({deviceId:item.id}));console.log('Devices:',devices);console.log('Total Price:',totalPrice);const response=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"api/orders/create\"),{devices:devices.map(device=>({deviceId:device.deviceId,price:device.price||0})),totalPrice:totalPrice,address:address},{headers:{Authorization:\"Bearer \".concat(localStorage.getItem('token'))}});console.log(\"Адрес перед отправкой заказа:\",address);console.log('Ответ сервера:',response.data);setPaymentMessage('Ваш заказ был успешно создан!');setPaymentStatus('success');}catch(error){console.error(\"Ошибка при создании заказа:\",error);setPaymentMessage(error.message||'Ошибка при создании заказа');setPaymentStatus('error');}setTimeout(()=>{navigate(SHOP_ROUTE);},200);}else{setPaymentMessage('Ошибка при оплате');setPaymentStatus('error');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"payment-page\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u0435 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-items\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0422\\u043E\\u0432\\u0430\\u0440\\u044B \\u0432 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0435:\"}),/*#__PURE__*/_jsx(\"ul\",{children:basket.map(item=>/*#__PURE__*/_jsxs(\"li\",{className:\"payment-item\",children:[item.name,\" - \",item.price,\" \\u20BD\"]},item.id))})]}),/*#__PURE__*/_jsx(\"div\",{className:\"total-price\",children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\u0418\\u0442\\u043E\\u0433\\u043E: \",/*#__PURE__*/_jsxs(\"strong\",{children:[totalPrice,\" \\u20BD\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"address-input\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"address\",children:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448 \\u0430\\u0434\\u0440\\u0435\\u0441:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"address\",value:address,onChange:e=>setAddress(e.target.value),placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448 \\u0430\\u0434\\u0440\\u0435\\u0441\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-instruction\",children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u0412\\u0430\\u0436\\u043D\\u043E:\"}),\" \\u041F\\u043E\\u0441\\u043B\\u0435 \\u043E\\u0444\\u043E\\u0440\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430 \\u0438 \\u043F\\u0435\\u0440\\u0435\\u0445\\u043E\\u0434\\u0430 \\u043A \\u043E\\u043F\\u043B\\u0430\\u0442\\u0435, \\u0432\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0441\\u043F\\u043E\\u0441\\u043E\\u0431 \\u043E\\u043F\\u043B\\u0430\\u0442\\u044B \\xAB\\u041D\\u0430\\u043B\\u0438\\u0447\\u043D\\u044B\\u0435 \\u043F\\u0440\\u0438 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u0438\\u0438\\xBB. \\u0412\\u0430\\u0448\\u0438 \\u0442\\u043E\\u0432\\u0430\\u0440\\u044B \\u0431\\u0443\\u0434\\u0443\\u0442 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043B\\u0435\\u043D\\u044B \\u043F\\u043E \\u0443\\u043A\\u0430\\u0437\\u0430\\u043D\\u043D\\u043E\\u043C\\u0443 \\u0430\\u0434\\u0440\\u0435\\u0441\\u0443. \\u041F\\u0440\\u0438 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u0438\\u0438 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0430 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u0439\\u0442\\u0435 \\u043A\\u0443\\u0440\\u044C\\u0435\\u0440\\u0443 \\u043D\\u0443\\u0436\\u043D\\u0443\\u044E \\u0441\\u0443\\u043C\\u043C\\u0443. \\u041F\\u043E\\u0436\\u0430\\u043B\\u0443\\u0439\\u0441\\u0442\\u0430, \\u0443\\u0431\\u0435\\u0434\\u0438\\u0442\\u0435\\u0441\\u044C, \\u0447\\u0442\\u043E \\u0432\\u0441\\u0435 \\u0442\\u043E\\u0432\\u0430\\u0440\\u044B \\u0432 \\u0437\\u0430\\u043A\\u0430\\u0437\\u0435 \\u0432\\u0435\\u0440\\u043D\\u044B \\u0438 \\u0432 \\u0445\\u043E\\u0440\\u043E\\u0448\\u0435\\u043C \\u0441\\u043E\\u0441\\u0442\\u043E\\u044F\\u043D\\u0438\\u0438. \\u0411\\u043B\\u0430\\u0433\\u043E\\u0434\\u0430\\u0440\\u0438\\u043C \\u0437\\u0430 \\u043F\\u043E\\u043A\\u0443\\u043F\\u043A\\u0443!\"]})}),paymentStatus==='success'&&/*#__PURE__*/_jsx(\"p\",{className:\"success-message\",children:paymentMessage}),paymentStatus==='error'&&/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:paymentMessage}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePayment,className:\"payment-btn\",children:\"\\u0417\\u0430\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C\"})]});};export default PaymentPage;","map":{"version":3,"names":["React","useState","useNavigate","useBasket","SHOP_ROUTE","axios","jsx","_jsx","jsxs","_jsxs","PaymentPage","basket","clearBasket","paymentStatus","setPaymentStatus","paymentMessage","setPaymentMessage","address","setAddress","navigate","totalPrice","reduce","sum","item","price","handlePayment","isPaymentSuccessful","length","Error","devices","map","deviceId","id","console","log","response","post","concat","process","env","REACT_APP_API_URL","device","headers","Authorization","localStorage","getItem","data","error","message","setTimeout","className","children","name","htmlFor","type","value","onChange","e","target","placeholder","onClick"],"sources":["/home/cracker1/Desktop/store/client/my-app/src/pages/Payment.js"],"sourcesContent":["import '../styles/PaymentPage.css';\r\nimport React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useBasket } from '../context/BasketContext';\r\nimport { SHOP_ROUTE } from '../utils/consts';\r\nimport axios from 'axios';\r\nimport '../styles/PaymentPage.css';\r\n\r\nconst PaymentPage = () => {\r\n    const { basket, clearBasket } = useBasket();\r\n    const [paymentStatus, setPaymentStatus] = useState(null);\r\n    const [paymentMessage, setPaymentMessage] = useState(\"\");\r\n    const [address, setAddress] = useState(\"\");\r\n    const navigate = useNavigate();\r\n\r\n    const totalPrice = basket.reduce((sum, item) => sum + item.price, 0);\r\n\r\n    const handlePayment = async () => {\r\n        if (!address) {\r\n            setPaymentMessage('Пожалуйста, введите ваш адрес.');\r\n            setPaymentStatus('error');\r\n            return;\r\n        }\r\n\r\n        const isPaymentSuccessful = true;\r\n\r\n        if (isPaymentSuccessful) {\r\n            setPaymentMessage('Заказ прошел успешно!');\r\n            setPaymentStatus('success');\r\n            clearBasket();\r\n\r\n            try {\r\n\r\n                if (basket.length === 0) {\r\n                    throw new Error('Корзина пуста');\r\n                }\r\n\r\n                const devices = basket.map(item => ({ deviceId: item.id }));\r\n\r\n                console.log('Devices:', devices);\r\n                console.log('Total Price:', totalPrice);\r\n\r\n                const response = await axios.post(`${process.env.REACT_APP_API_URL}api/orders/create`, {\r\n                    devices: devices.map(device => ({\r\n                        deviceId: device.deviceId,\r\n                        price: device.price || 0,\r\n                    })),\r\n                    totalPrice: totalPrice,\r\n                    address: address,\r\n                }, {\r\n                    headers: {\r\n                        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n                    },\r\n                });\r\n                console.log(\"Адрес перед отправкой заказа:\", address);\r\n\r\n                console.log('Ответ сервера:', response.data);\r\n\r\n\r\n                setPaymentMessage('Ваш заказ был успешно создан!');\r\n                setPaymentStatus('success');\r\n\r\n            } catch (error) {\r\n                console.error(\"Ошибка при создании заказа:\", error);\r\n                setPaymentMessage(error.message || 'Ошибка при создании заказа');\r\n                setPaymentStatus('error');\r\n            }\r\n\r\n\r\n            setTimeout(() => {\r\n                navigate(SHOP_ROUTE);\r\n            }, 200);\r\n\r\n        } else {\r\n            setPaymentMessage('Ошибка при оплате');\r\n            setPaymentStatus('error');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"payment-page\">\r\n            <h2>Оформление заказа</h2>\r\n\r\n            <div className=\"payment-items\">\r\n                <h3>Товары в заказе:</h3>\r\n                <ul>\r\n                    {basket.map((item) => (\r\n                        <li key={item.id} className=\"payment-item\">\r\n                            {item.name} - {item.price} ₽\r\n                        </li>\r\n                    ))}\r\n                </ul>\r\n            </div>\r\n\r\n            <div className=\"total-price\">\r\n                <h3>Итого: <strong>{totalPrice} ₽</strong></h3>\r\n            </div>\r\n\r\n            <div className=\"address-input\">\r\n                <label htmlFor=\"address\">Введите ваш адрес:</label>\r\n                <input\r\n                    type=\"text\"\r\n                    id=\"address\"\r\n                    value={address}\r\n                    onChange={(e) => setAddress(e.target.value)}\r\n                    placeholder=\"Введите ваш адрес\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"payment-instruction\">\r\n                <p><strong>Важно:</strong> После оформления заказа и перехода к оплате, выберите способ оплаты «Наличные при получении». Ваши товары будут доставлены по указанному адресу. При получении заказа передайте курьеру нужную сумму. Пожалуйста, убедитесь, что все товары в заказе верны и в хорошем состоянии. Благодарим за покупку!</p>\r\n            </div>\r\n\r\n            {paymentStatus === 'success' && (\r\n                <p className=\"success-message\">{paymentMessage}</p>\r\n            )}\r\n\r\n            {paymentStatus === 'error' && (\r\n                <p className=\"error-message\">{paymentMessage}</p>\r\n            )}\r\n\r\n            <button onClick={handlePayment} className=\"payment-btn\">\r\n                Заказать\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PaymentPage;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
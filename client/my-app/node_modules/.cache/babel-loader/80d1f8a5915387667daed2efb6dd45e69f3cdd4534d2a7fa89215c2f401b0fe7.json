{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u0420\\u043E\\u043C\\u0430\\\\WebstormProjects\\\\store\\\\client\\\\my-app\\\\src\\\\context\\\\BasketContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport { jwtDecode } from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BasketContext = /*#__PURE__*/createContext();\nexport const useBasket = () => {\n  _s();\n  return useContext(BasketContext);\n};\n_s(useBasket, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const BasketProvider = ({\n  children\n}) => {\n  _s2();\n  // Получаем userId из токена, если пользователь авторизован\n  const token = localStorage.getItem('token');\n  let userId = null;\n  if (token) {\n    try {\n      const decoded = jwtDecode(token);\n      userId = decoded.id; // Берем ID из токена\n    } catch (error) {\n      console.error(\"Ошибка при декодировании токена:\", error);\n    }\n  }\n\n  // Если нет userId, создаем guestId\n  const storedGuestId = localStorage.getItem('guestId');\n  const guestId = storedGuestId || uuidv4();\n  if (!storedGuestId) {\n    localStorage.setItem('guestId', guestId);\n  }\n  const currentUserId = userId || guestId;\n  const storageKey = `basket_${currentUserId}`;\n  const [basket, setBasket] = useState(() => {\n    const savedBasket = localStorage.getItem(storageKey);\n    return savedBasket ? JSON.parse(savedBasket) : [];\n  });\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(basket));\n  }, [basket, storageKey]);\n  const addToBasket = device => {\n    const newItem = {\n      ...device,\n      basketId: uuidv4()\n    };\n    setBasket(prevBasket => [...prevBasket, newItem]);\n  };\n  const removeFromBasket = basketId => {\n    setBasket(prevBasket => prevBasket.filter(item => item.basketId !== basketId));\n  };\n  const clearBasket = () => {\n    setBasket([]);\n  };\n  return /*#__PURE__*/_jsxDEV(BasketContext.Provider, {\n    value: {\n      basket,\n      addToBasket,\n      removeFromBasket,\n      clearBasket\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 9\n  }, this);\n};\n_s2(BasketProvider, \"sDmlWwWr/w0UEx1afM1BSBphjEI=\");\n_c = BasketProvider;\nvar _c;\n$RefreshReg$(_c, \"BasketProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","v4","uuidv4","jwtDecode","jsxDEV","_jsxDEV","BasketContext","useBasket","_s","BasketProvider","children","_s2","token","localStorage","getItem","userId","decoded","id","error","console","storedGuestId","guestId","setItem","currentUserId","storageKey","basket","setBasket","savedBasket","JSON","parse","stringify","addToBasket","device","newItem","basketId","prevBasket","removeFromBasket","filter","item","clearBasket","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Рома/WebstormProjects/store/client/my-app/src/context/BasketContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nconst BasketContext = createContext();\r\n\r\nexport const useBasket = () => useContext(BasketContext);\r\n\r\nexport const BasketProvider = ({ children }) => {\r\n    // Получаем userId из токена, если пользователь авторизован\r\n    const token = localStorage.getItem('token');\r\n    let userId = null;\r\n\r\n    if (token) {\r\n        try {\r\n            const decoded = jwtDecode(token);\r\n            userId = decoded.id; // Берем ID из токена\r\n        } catch (error) {\r\n            console.error(\"Ошибка при декодировании токена:\", error);\r\n        }\r\n    }\r\n\r\n    // Если нет userId, создаем guestId\r\n    const storedGuestId = localStorage.getItem('guestId');\r\n    const guestId = storedGuestId || uuidv4();\r\n\r\n    if (!storedGuestId) {\r\n        localStorage.setItem('guestId', guestId);\r\n    }\r\n\r\n    const currentUserId = userId || guestId;\r\n    const storageKey = `basket_${currentUserId}`;\r\n\r\n    const [basket, setBasket] = useState(() => {\r\n        const savedBasket = localStorage.getItem(storageKey);\r\n        return savedBasket ? JSON.parse(savedBasket) : [];\r\n    });\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(storageKey, JSON.stringify(basket));\r\n    }, [basket, storageKey]);\r\n\r\n    const addToBasket = (device) => {\r\n        const newItem = { ...device, basketId: uuidv4() };\r\n        setBasket((prevBasket) => [...prevBasket, newItem]);\r\n    };\r\n\r\n    const removeFromBasket = (basketId) => {\r\n        setBasket((prevBasket) => prevBasket.filter((item) => item.basketId !== basketId));\r\n    };\r\n\r\n    const clearBasket = () => {\r\n        setBasket([]);\r\n    };\r\n\r\n    return (\r\n        <BasketContext.Provider value={{ basket, addToBasket, removeFromBasket, clearBasket }}>\r\n            {children}\r\n        </BasketContext.Provider>\r\n    );\r\n};\r\n\r\n\r\n\r\n\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,UAAU,EAAEC,SAAS,QAAQ,OAAO;AAC7E,SAASC,EAAE,IAAIC,MAAM,QAAQ,MAAM;AACnC,SAASC,SAAS,QAAQ,YAAY;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEvC,MAAMC,aAAa,gBAAGT,aAAa,CAAC,CAAC;AAErC,OAAO,MAAMU,SAAS,GAAGA,CAAA;EAAAC,EAAA;EAAA,OAAMT,UAAU,CAACO,aAAa,CAAC;AAAA;AAACE,EAAA,CAA5CD,SAAS;AAEtB,OAAO,MAAME,cAAc,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,GAAA;EAC5C;EACA,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAIC,MAAM,GAAG,IAAI;EAEjB,IAAIH,KAAK,EAAE;IACP,IAAI;MACA,MAAMI,OAAO,GAAGb,SAAS,CAACS,KAAK,CAAC;MAChCG,MAAM,GAAGC,OAAO,CAACC,EAAE,CAAC,CAAC;IACzB,CAAC,CAAC,OAAOC,KAAK,EAAE;MACZC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;IAC5D;EACJ;;EAEA;EACA,MAAME,aAAa,GAAGP,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC;EACrD,MAAMO,OAAO,GAAGD,aAAa,IAAIlB,MAAM,CAAC,CAAC;EAEzC,IAAI,CAACkB,aAAa,EAAE;IAChBP,YAAY,CAACS,OAAO,CAAC,SAAS,EAAED,OAAO,CAAC;EAC5C;EAEA,MAAME,aAAa,GAAGR,MAAM,IAAIM,OAAO;EACvC,MAAMG,UAAU,GAAG,UAAUD,aAAa,EAAE;EAE5C,MAAM,CAACE,MAAM,EAAEC,SAAS,CAAC,GAAG5B,QAAQ,CAAC,MAAM;IACvC,MAAM6B,WAAW,GAAGd,YAAY,CAACC,OAAO,CAACU,UAAU,CAAC;IACpD,OAAOG,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACF,WAAW,CAAC,GAAG,EAAE;EACrD,CAAC,CAAC;EAEF3B,SAAS,CAAC,MAAM;IACZa,YAAY,CAACS,OAAO,CAACE,UAAU,EAAEI,IAAI,CAACE,SAAS,CAACL,MAAM,CAAC,CAAC;EAC5D,CAAC,EAAE,CAACA,MAAM,EAAED,UAAU,CAAC,CAAC;EAExB,MAAMO,WAAW,GAAIC,MAAM,IAAK;IAC5B,MAAMC,OAAO,GAAG;MAAE,GAAGD,MAAM;MAAEE,QAAQ,EAAEhC,MAAM,CAAC;IAAE,CAAC;IACjDwB,SAAS,CAAES,UAAU,IAAK,CAAC,GAAGA,UAAU,EAAEF,OAAO,CAAC,CAAC;EACvD,CAAC;EAED,MAAMG,gBAAgB,GAAIF,QAAQ,IAAK;IACnCR,SAAS,CAAES,UAAU,IAAKA,UAAU,CAACE,MAAM,CAAEC,IAAI,IAAKA,IAAI,CAACJ,QAAQ,KAAKA,QAAQ,CAAC,CAAC;EACtF,CAAC;EAED,MAAMK,WAAW,GAAGA,CAAA,KAAM;IACtBb,SAAS,CAAC,EAAE,CAAC;EACjB,CAAC;EAED,oBACIrB,OAAA,CAACC,aAAa,CAACkC,QAAQ;IAACC,KAAK,EAAE;MAAEhB,MAAM;MAAEM,WAAW;MAAEK,gBAAgB;MAAEG;IAAY,CAAE;IAAA7B,QAAA,EACjFA;EAAQ;IAAAgC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACW,CAAC;AAEjC,CAAC;AAAClC,GAAA,CApDWF,cAAc;AAAAqC,EAAA,GAAdrC,cAAc;AAAA,IAAAqC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
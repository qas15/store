{"ast":null,"code":"import _objectSpread from\"/home/cracker1/Desktop/store/client/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useState,useContext,useEffect}from'react';import{v4 as uuidv4}from'uuid';import{jwtDecode}from'jwt-decode';import{jsx as _jsx}from\"react/jsx-runtime\";const BasketContext=/*#__PURE__*/createContext();export const useBasket=()=>useContext(BasketContext);export const BasketProvider=_ref=>{let{children}=_ref;const token=localStorage.getItem('token');let userId=null;if(token){try{const decoded=jwtDecode(token);userId=decoded.id;}catch(error){console.error(\"Ошибка при декодировании токена:\",error);}}const storedGuestId=localStorage.getItem('guestId');const guestId=storedGuestId||uuidv4();if(!storedGuestId){localStorage.setItem('guestId',guestId);}const currentUserId=userId||guestId;const storageKey=\"basket_\".concat(currentUserId);const[basket,setBasket]=useState(()=>{const savedBasket=localStorage.getItem(storageKey);return savedBasket?JSON.parse(savedBasket):[];});useEffect(()=>{localStorage.setItem(storageKey,JSON.stringify(basket));},[basket,storageKey]);const addToBasket=device=>{const newItem=_objectSpread(_objectSpread({},device),{},{basketId:uuidv4()});setBasket(prevBasket=>[...prevBasket,newItem]);};const removeFromBasket=basketId=>{setBasket(prevBasket=>prevBasket.filter(item=>item.basketId!==basketId));};const clearBasket=()=>{setBasket([]);};return/*#__PURE__*/_jsx(BasketContext.Provider,{value:{basket,addToBasket,removeFromBasket,clearBasket},children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","v4","uuidv4","jwtDecode","jsx","_jsx","BasketContext","useBasket","BasketProvider","_ref","children","token","localStorage","getItem","userId","decoded","id","error","console","storedGuestId","guestId","setItem","currentUserId","storageKey","concat","basket","setBasket","savedBasket","JSON","parse","stringify","addToBasket","device","newItem","_objectSpread","basketId","prevBasket","removeFromBasket","filter","item","clearBasket","Provider","value"],"sources":["/home/cracker1/Desktop/store/client/my-app/src/context/BasketContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\nconst BasketContext = createContext();\r\n\r\nexport const useBasket = () => useContext(BasketContext);\r\n\r\nexport const BasketProvider = ({ children }) => {\r\n\r\n    const token = localStorage.getItem('token');\r\n    let userId = null;\r\n\r\n    if (token) {\r\n        try {\r\n            const decoded = jwtDecode(token);\r\n            userId = decoded.id;\r\n        } catch (error) {\r\n            console.error(\"Ошибка при декодировании токена:\", error);\r\n        }\r\n    }\r\n\r\n\r\n    const storedGuestId = localStorage.getItem('guestId');\r\n    const guestId = storedGuestId || uuidv4();\r\n\r\n    if (!storedGuestId) {\r\n        localStorage.setItem('guestId', guestId);\r\n    }\r\n\r\n    const currentUserId = userId || guestId;\r\n    const storageKey = `basket_${currentUserId}`;\r\n\r\n    const [basket, setBasket] = useState(() => {\r\n        const savedBasket = localStorage.getItem(storageKey);\r\n        return savedBasket ? JSON.parse(savedBasket) : [];\r\n    });\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem(storageKey, JSON.stringify(basket));\r\n    }, [basket, storageKey]);\r\n\r\n    const addToBasket = (device) => {\r\n        const newItem = { ...device, basketId: uuidv4() };\r\n        setBasket((prevBasket) => [...prevBasket, newItem]);\r\n    };\r\n\r\n    const removeFromBasket = (basketId) => {\r\n        setBasket((prevBasket) => prevBasket.filter((item) => item.basketId !== basketId));\r\n    };\r\n\r\n    const clearBasket = () => {\r\n        setBasket([]);\r\n    };\r\n\r\n    return (\r\n        <BasketContext.Provider value={{ basket, addToBasket, removeFromBasket, clearBasket }}>\r\n            {children}\r\n        </BasketContext.Provider>\r\n    );\r\n};\r\n\r\n\r\n\r\n\r\n"],"mappings":"+HAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,UAAU,CAAEC,SAAS,KAAQ,OAAO,CAC7E,OAASC,EAAE,GAAI,CAAAC,MAAM,KAAQ,MAAM,CACnC,OAASC,SAAS,KAAQ,YAAY,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEvC,KAAM,CAAAC,aAAa,cAAGT,aAAa,CAAC,CAAC,CAErC,MAAO,MAAM,CAAAU,SAAS,CAAGA,CAAA,GAAMR,UAAU,CAACO,aAAa,CAAC,CAExD,MAAO,MAAM,CAAAE,cAAc,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CAEvC,KAAM,CAAAE,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAAAC,MAAM,CAAG,IAAI,CAEjB,GAAIH,KAAK,CAAE,CACP,GAAI,CACA,KAAM,CAAAI,OAAO,CAAGZ,SAAS,CAACQ,KAAK,CAAC,CAChCG,MAAM,CAAGC,OAAO,CAACC,EAAE,CACvB,CAAE,MAAOC,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CAC5D,CACJ,CAGA,KAAM,CAAAE,aAAa,CAAGP,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,CACrD,KAAM,CAAAO,OAAO,CAAGD,aAAa,EAAIjB,MAAM,CAAC,CAAC,CAEzC,GAAI,CAACiB,aAAa,CAAE,CAChBP,YAAY,CAACS,OAAO,CAAC,SAAS,CAAED,OAAO,CAAC,CAC5C,CAEA,KAAM,CAAAE,aAAa,CAAGR,MAAM,EAAIM,OAAO,CACvC,KAAM,CAAAG,UAAU,WAAAC,MAAA,CAAaF,aAAa,CAAE,CAE5C,KAAM,CAACG,MAAM,CAAEC,SAAS,CAAC,CAAG5B,QAAQ,CAAC,IAAM,CACvC,KAAM,CAAA6B,WAAW,CAAGf,YAAY,CAACC,OAAO,CAACU,UAAU,CAAC,CACpD,MAAO,CAAAI,WAAW,CAAGC,IAAI,CAACC,KAAK,CAACF,WAAW,CAAC,CAAG,EAAE,CACrD,CAAC,CAAC,CAEF3B,SAAS,CAAC,IAAM,CACZY,YAAY,CAACS,OAAO,CAACE,UAAU,CAAEK,IAAI,CAACE,SAAS,CAACL,MAAM,CAAC,CAAC,CAC5D,CAAC,CAAE,CAACA,MAAM,CAAEF,UAAU,CAAC,CAAC,CAExB,KAAM,CAAAQ,WAAW,CAAIC,MAAM,EAAK,CAC5B,KAAM,CAAAC,OAAO,CAAAC,aAAA,CAAAA,aAAA,IAAQF,MAAM,MAAEG,QAAQ,CAAEjC,MAAM,CAAC,CAAC,EAAE,CACjDwB,SAAS,CAAEU,UAAU,EAAK,CAAC,GAAGA,UAAU,CAAEH,OAAO,CAAC,CAAC,CACvD,CAAC,CAED,KAAM,CAAAI,gBAAgB,CAAIF,QAAQ,EAAK,CACnCT,SAAS,CAAEU,UAAU,EAAKA,UAAU,CAACE,MAAM,CAAEC,IAAI,EAAKA,IAAI,CAACJ,QAAQ,GAAKA,QAAQ,CAAC,CAAC,CACtF,CAAC,CAED,KAAM,CAAAK,WAAW,CAAGA,CAAA,GAAM,CACtBd,SAAS,CAAC,EAAE,CAAC,CACjB,CAAC,CAED,mBACIrB,IAAA,CAACC,aAAa,CAACmC,QAAQ,EAACC,KAAK,CAAE,CAAEjB,MAAM,CAAEM,WAAW,CAAEM,gBAAgB,CAAEG,WAAY,CAAE,CAAA9B,QAAA,CACjFA,QAAQ,CACW,CAAC,CAEjC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}